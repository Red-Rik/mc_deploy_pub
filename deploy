#!/bin/bash

# Функция для установки Docker
install_docker() {
    echo "Docker не найден! Устанавливаем Docker..."

    # Для Ubuntu/Debian
    if [ -f /etc/debian_version ]; then
        sudo apt update
        sudo apt install -y apt-transport-https ca-certificates curl software-properties-common
        curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/trusted.gpg.d/docker.gpg
        sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"
        sudo apt update
        sudo apt install -y docker-ce
    fi

    # Для CentOS/RHEL
    if [ -f /etc/redhat-release ]; then
        sudo yum install -y yum-utils
        sudo yum install -y docker-ce
    fi

    # Для Fedora
    if [ -f /etc/fedora-release ]; then
        sudo dnf install -y docker-ce
    fi

    # Запуск и настройка Docker
    sudo systemctl start docker
    sudo systemctl enable docker
    sudo usermod -aG docker $USER
    echo "Docker установлен и запущен."
}

# Проверяем, установлен ли Docker
if ! command -v docker &> /dev/null; then
    install_docker
else
    echo "Docker уже установлен."
fi

# Переменные
IMAGE="itzg/minecraft-server"  # Docker-образ для Minecraft сервера
CONTAINER_NAME="minecraft_server"  # Имя контейнера
PORT="25565"  # Порт для Minecraft сервера
MEMORY="2G"  # Количество памяти для сервера
EULA="TRUE"  # Принятие EULA

# Запуск Docker контейнера
docker run -d \
  --name $CONTAINER_NAME \
  -p $PORT:25565 \
  -e EULA=$EULA \
  -e MEMORY=$MEMORY \
  --restart unless-stopped \
  $IMAGE

# Проверка состояния контейнера
if [ $? -eq 0 ]; then
    echo "Minecraft сервер успешно установлен и запущен!"
    echo "Подключитесь к серверу через: localhost:$PORT"
else
    echo "Произошла ошибка при запуске сервера."
    exit 1
fi
